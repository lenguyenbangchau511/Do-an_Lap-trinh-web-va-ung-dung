<!doctype html>
<html lang="vi">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Tổng quan - admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap"
        rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="admin.css">

</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar">
            <div class="bloom-logo" aria-label="Bloom - Trở về trang chủ">
                <svg class="logo-icon" viewBox="0 0 100 100" fill="none" aria-hidden="true">
                    <circle cx="50" cy="50" r="45" fill="#2e7d68" opacity="0.9" />
                    <path d="M50 20 C60 15, 75 25, 75 40 C75 55, 60 65, 50 70 C40 65, 25 55, 25 40 C25 25, 40 15, 50 20"
                        fill="#eaf8f0" />
                    <circle cx="40" cy="35" r="8" fill="#b19cd9" />
                    <circle cx="60" cy="35" r="8" fill="#b19cd9" />
                    <circle cx="50" cy="50" r="12" fill="#9370db" />
                    <path d="M50 70 L45 85 L55 85 Z" fill="#2e7d68" />
                </svg>
                <span>Bloom</span>
            </div>
            <a href="0_dashboard.html"><i class="fa-sharp fa-solid fa-house"></i></i> Tổng quan</a>
            <a href="1_users.html"><i class="fa-solid fa-users me-2"></i>Quản lý khách hàng</a>
            <a href="2_products.html"><i class="fa-solid fa-bread-slice me-2"></i>Quản lý sản phẩm</a>
            <a href="3_category.html"><i class="fa-solid fa-folder-tree me-2"></i>Quản lý danh mục</a>
            <a href="4_price.html"><i class="fa-regular fa-money-bill-1"></i> Quản lý giá bán</a>
            <a href="5_orders.html"><i class="fa-regular fa-rectangle-list"></i> Quản lý đơn hàng</a>
            <a href="6_inputproduct.html"><i class="fa-regular fa-pen-to-square"></i> Quản lý nhập hàng</a>
            <a href="7_inventory.html" class="active"> <i class="fa-sharp fa-solid fa-truck"></i> Quản lý tồn kho</a>
            <div class="logout_admin"><a href="../index.html" id="logout-link">Đăng xuất</a></div>
            <script>
                document.getElementById("logout-link").addEventListener("click", function (event) {
                    event.preventDefault(); // Ngăn chặn chuyển trang ngay lập tức
                    const confirmLogout = confirm("Bạn có chắc chắn muốn đăng xuất không?");

                    if (confirmLogout) {
                        window.location.href = this.href; // Chuyển đến trang đăng xuất nếu xác nhận
                    }
                });
            </script>
        </div>
    </div>

    <!-- Main Content -->
  <div class="main-content">
    <div class="header">
      <div class="header__title"><i class="fa-sharp fa-solid fa-truck me-2"></i>Quản lý tồn kho</div>
      <div class="header__info">
        <span class="text-muted small">Xin chào, Admin</span>
        <a href="#"><i class="fa-solid fa-user-tie"></i></a>
      </div>
    </div>

    <div class="container-fluid" data-aos="fade-up">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <button class="btn btn-success" id="openAddInventoryModal"><i class="fa-solid fa-plus"></i> Thêm sản phẩm tồn kho</button>
        </div>
        <div class="d-flex gap-2">
          <input id="searchInventory" class="form-control" placeholder="Tìm kiếm theo tên hoặc mã sản phẩm...">
          <select id="filterStatus" class="form-select" style="width: 250px;">
            <option value="">Tất cả trạng thái</option>
            <option value="Còn hàng">Còn hàng</option>
            <option value="Sắp hết">Sắp hết</option>
            <option value="Hết hàng">Hết hàng</option>
          </select>
        </div>
      </div>

      <div class="card shadow-sm">
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover align-middle text-center">
              <thead class="table-light">
                <tr>
                  <th>Mã sản phẩm</th>
                  <th>Tên sản phẩm</th>
                  <th>Số lượng tồn</th>
                  <th>Đơn vị</th>
                  <th>Giá nhập (VNĐ)</th>
                  <th>Trạng thái</th>
                  <th>Hành động</th>
                </tr>
              </thead>
              <tbody id="inventoryTableBody"></tbody>
            </table>
            <ul id="pagination">
              </li>
              <li class="pagination-item">
                <a href="7_inventory.html" class="pagination-item__link active">1</a>
              </li>
              <li class="pagination-item">
                <a href="7_inventory.html" class="pagination-item__link " target="_self">2</a>
              </li>
              <li class="pagination-item">
                <a href="7_inventory.html" class="pagination-item__link " target="_self">3</a>
              </li>
              <li class="pagination-item">
                <a href="7_inventory.html" class="pagination-item__link " target="_self">4</a>
              </li>
              <li class="pagination-item">
                <a href="7_inventory.html" class="pagination-item__link " target="_self">5</a>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <footer class="mt-4">
        <p class="text-center text-muted">&copy; 2024 Bloom - Shop hoa tươi. All rights reserved.</p>
      </footer>
    </div>
  </div>

  <!-- Modal thêm/sửa sản phẩm tồn kho -->
  <div class="modal fade" id="inventoryModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content shadow-lg border-0 rounded-4">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title fw-bold" id="inventoryModalTitle">Thêm sản phẩm tồn kho</h5>
          <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="inventoryForm">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label fw-semibold">Mã sản phẩm</label>
                <input type="text" id="i_code" class="form-control" required>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-semibold">Tên sản phẩm</label>
                <input type="text" id="i_name" class="form-control" required>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-semibold">Số lượng tồn</label>
                <input type="number" id="i_quantity" class="form-control" min="0" required>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-semibold">Đơn vị</label>
                <input type="text" id="i_unit" class="form-control" placeholder="Bó, chậu, giỏ..." required>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-semibold">Giá nhập (VNĐ)</label>
                <input type="number" id="i_price" class="form-control" min="0" required>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-semibold">Trạng thái</label>
                <select id="i_status" class="form-select">
                  <option value="Còn hàng">Còn hàng</option>
                  <option value="Sắp hết">Sắp hết</option>
                  <option value="Hết hàng">Hết hàng</option>
                </select>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer bg-light">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
          <button class="btn btn-success" id="saveInventory"><i class="fa-solid fa-floppy-disk me-1"></i> Lưu</button>
        </div>
      </div>
    </div>
  </div>

  <div class="position-fixed top-0 end-0 p-3" style="z-index: 1080" id="toastContainer"></div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>
    AOS.init();

    let inventory = [
      { code: 'SP001', name: 'Peach', quantity: 15, unit: 'bó', price: 250000, status: 'Còn hàng' },
      { code: 'SP002', name: 'BlueSky', quantity: 5, unit: 'bó', price: 320000, status: 'Sắp hết' },
      { code: 'SP003', name: 'Hồng Phát', quantity: 0, unit: 'kệ', price: 280000, status: 'Hết hàng' },
      { code: 'SP004', name: 'Sen Xanh', quantity: 8, unit: 'lẵng', price: 450000, status: 'Còn hàng' },
      { code: 'SP005', name: 'Tương Lai', quantity: 2, unit: 'bó', price: 390000, status: 'Sắp hết' },
    ];

    const tbody = document.getElementById('inventoryTableBody');
    const toastContainer = document.getElementById('toastContainer');
    const modal = new bootstrap.Modal(document.getElementById('inventoryModal'));
    let editIndex = null;

    function showToast(message, type = 'success') {
      const bg = type === 'error' ? 'bg-danger' : 'bg-success';
      const toast = document.createElement('div');
      toast.className = `toast align-items-center text-white border-0 ${bg}`;
      toast.role = 'alert';
      toast.innerHTML = `
        <div class="d-flex">
          <div class="toast-body">${message}</div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>`;
      toastContainer.appendChild(toast);
      const bsToast = new bootstrap.Toast(toast, { delay: 2000 });
      bsToast.show();
      toast.addEventListener('hidden.bs.toast', () => toast.remove());
    }

    function renderTable(data) {
      tbody.innerHTML = '';
      data.forEach((item, i) => {
        tbody.innerHTML += `
          <tr>
            <td>${item.code}</td>
            <td>${item.name}</td>
            <td>${item.quantity}</td>
            <td>${item.unit}</td>
            <td>${item.price.toLocaleString()}</td>
            <td>${item.status}</td>
            <td>
              <button class="btn btn-sm btn-outline-primary me-1 edit-btn" data-index="${i}">
                <i class="fa-solid fa-pen"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger delete-btn" data-index="${i}">
                <i class="fa-solid fa-trash"></i>
              </button>
            </td>
          </tr>`;
      });
    }
    renderTable(inventory);

    document.getElementById('openAddInventoryModal').addEventListener('click', () => {
      editIndex = null;
      document.getElementById('inventoryForm').reset();
      document.getElementById('inventoryModalTitle').textContent = 'Thêm sản phẩm tồn kho';
      modal.show();
    });

    document.getElementById('saveInventory').addEventListener('click', () => {
      const i_code = document.getElementById('i_code').value.trim();
      const i_name = document.getElementById('i_name').value.trim();
      const i_quantity = Number(document.getElementById('i_quantity').value);
      const i_unit = document.getElementById('i_unit').value.trim();
      const i_price = Number(document.getElementById('i_price').value);
      const i_status = document.getElementById('i_status').value;

      if (!i_code || !i_name) return showToast('Vui lòng nhập đủ thông tin!', 'error');
      if (inventory.some((p, idx) => p.code === i_code && idx !== editIndex))
        return showToast('Mã sản phẩm đã tồn tại!', 'error');

      const data = { code: i_code, name: i_name, quantity: i_quantity, unit: i_unit, price: i_price, status: i_status };

      if (editIndex === null) {
        inventory.push(data);
        showToast('Thêm sản phẩm thành công!');
      } else {
        inventory[editIndex] = data;
        showToast('Cập nhật thành công!');
      }
      modal.hide();
    });

    tbody.addEventListener('click', e => {
      const editBtn = e.target.closest('.edit-btn');
      const delBtn = e.target.closest('.delete-btn');

      if (editBtn) {
        editIndex = Number(editBtn.dataset.index);
        const item = inventory[editIndex];
        document.getElementById('inventoryModalTitle').textContent = 'Sửa thông tin sản phẩm';
        document.getElementById('i_code').value = item.code;
        document.getElementById('i_name').value = item.name;
        document.getElementById('i_quantity').value = item.quantity;
        document.getElementById('i_unit').value = item.unit;
        document.getElementById('i_price').value = item.price;
        document.getElementById('i_status').value = item.status;
        modal.show();
      }

      if (delBtn) {
        const index = Number(delBtn.dataset.index);
        if (confirm(`Xóa sản phẩm "${inventory[index].name}"?`)) {
          inventory.splice(index, 1);
          showToast('Đã xóa sản phẩm!');
        }
      }
    });

    function normalize(str) {
      return str.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase();
    }

    document.getElementById('searchInventory').addEventListener('input', filterInventory);
    document.getElementById('filterStatus').addEventListener('change', filterInventory);

    function filterInventory() {
      const keyword = normalize(document.getElementById('searchInventory').value);
      const status = document.getElementById('filterStatus').value;
      const filtered = inventory.filter(p =>
        (normalize(p.name).includes(keyword) || normalize(p.code).includes(keyword)) &&
        (status === '' || p.status === status)
      );
      renderTable(filtered);
    }
    const pagination = document.getElementById('pagination');
  pagination.addEventListener('click', e => {
    if (e.target.classList.contains('pagination-item__link')) {
      e.preventDefault();
      const currentActive = pagination.querySelector('.pagination-item__link.active');
      if (currentActive) currentActive.classList.remove('active');
      e.target.classList.add('active');
    }
  });
  </script>
</body>
</html>