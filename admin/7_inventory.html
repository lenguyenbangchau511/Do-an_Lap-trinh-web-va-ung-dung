<!doctype html>
<html lang="vi">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tổng quan - admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap"
    rel="stylesheet">
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/admin.css">
  <style>
    .warning-badge {
      background: linear-gradient(135deg, #ffd700 0%, #ffa500 100%);
      color: #000;
      font-weight: 600;
      animation: pulse 2s infinite;
    }

    .danger-badge {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
      color: white;
      font-weight: 600;
    }

    .success-badge {
      background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
      color: white;
      font-weight: 600;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.05);
      }

      100% {
        transform: scale(1);
      }
    }

    .warning-row {
      background: rgba(255, 193, 7, 0.1) !important;
    }

    .danger-row {
      background: rgba(220, 53, 69, 0.1) !important;
    }

    .inventory-stats {
      background: linear-gradient(135deg, #b6e0cf  0%, #c7e4d9 100%);
      color: rgb(0, 0, 0);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .stat-item {
      text-align: center;
      padding: 10px;
    }

    .stat-number {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    .nav-tabs .nav-link.active {
      background: linear-gradient(135deg, #2e7d68 0%, #4c9c85 100%);
      color: white;
      border: none;
      font-weight: 600;
    }

    .nav-tabs .nav-link {
      color: #2e7d68;
      font-weight: 500;
    }

    .product-img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 8px;
      border: 2px solid #e9ecef;
    }
  </style>
</head>

<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar">
      <div class="bloom-logo" aria-label="Bloom - Trở về trang chủ">
        <svg class="logo-icon" viewBox="0 0 100 100" fill="none" aria-hidden="true">
          <circle cx="50" cy="50" r="45" fill="#2e7d68" opacity="0.9" />
          <path d="M50 20 C60 15, 75 25, 75 40 C75 55, 60 65, 50 70 C40 65, 25 55, 25 40 C25 25, 40 15, 50 20"
            fill="#eaf8f0" />
          <circle cx="40" cy="35" r="8" fill="#b19cd9" />
          <circle cx="60" cy="35" r="8" fill="#b19cd9" />
          <circle cx="50" cy="50" r="12" fill="#9370db" />
          <path d="M50 70 L45 85 L55 85 Z" fill="#2e7d68" />
        </svg>
        <span>Bloom</span>
      </div>
      <a href="0_dashboard.html"><i class="fa-sharp fa-solid fa-house"></i></i> Tổng quan</a>
      <a href="1_users.html"><i class="fa-solid fa-users me-2"></i>Quản lý khách hàng</a>
      <a href="2_products.html"><i class="fa-solid fa-bread-slice me-2"></i>Quản lý sản phẩm</a>
      <a href="3_category.html"><i class="fa-solid fa-folder-tree me-2"></i>Quản lý danh mục</a>
      <a href="4_price.html"><i class="fa-regular fa-money-bill-1"></i> Quản lý giá bán</a>
      <a href="5_orders.html"><i class="fa-regular fa-rectangle-list"></i> Quản lý đơn hàng</a>
      <a href="6_inputproduct.html"><i class="fa-regular fa-pen-to-square"></i> Quản lý nhập hàng</a>
      <a href="7_inventory.html" class="active"> <i class="fa-solid fa-boxes-stacked me-2"></i></i> Quản lý tồn kho</a>
      <div class="logout_admin"><a href="index.html" id="logout-link">Đăng xuất</a></div>
      <script>
        document.getElementById("logout-link").addEventListener("click", function (event) {
          event.preventDefault(); // Ngăn chặn chuyển trang ngay lập tức
          const confirmLogout = confirm("Bạn có chắc chắn muốn đăng xuất không?");

          if (confirmLogout) {
            window.location.href = this.href; // Chuyển đến trang đăng xuất nếu xác nhận
          }
        });
      </script>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- header  -->
    <div class="header">
      <div class="header__title"> <i class="fa-solid fa-boxes-stacked me-2"></i></i> Quản lý tồn kho</div>
      <div class="header__info">
        <div>
          <span class="text-muted small">Xin chào, Admin</span>
          <a href="javascript:void(0)" id="userMenuToggle">
            <i class="fa-solid fa-user-tie ms-2"></i>
          </a>
        </div>
        <!-- Dropdown Menu -->
        <div class="user-dropdown" id="userDropdown">
          <div class="dropdown-header">
            <div class="user-name">Admin User</div>
            <div class="user-role">Quản trị viên</div>
            <span>_________________________________________________</span>
          </div>
          <ul class="dropdown-menu">
            <li>
              <a href="#" class="dropdown-item">
                <i class="fa-solid fa-user"></i>
                <span>Hồ sơ cá nhân</span>
              </a>
            </li>
            <li>
              <a href="#" class="dropdown-item">
                <i class="fa-solid fa-gear"></i>
                <span>Cài đặt</span>
              </a>
            </li>
            <li class="dropdown-divider"></li>
            <li>
              <button class="dropdown-item logout" id="logoutBtn">
                <i class="fa-solid fa-right-from-bracket"></i>
                <span>Đăng xuất</span>
              </button>
            </li>
          </ul>
        </div>
        <!-- Overlay -->
        <div class="dropdown-overlay" id="dropdownOverlay"></div>
      </div>
    </div>

    <div class="container-fluid" data-aos="fade-up">
      <!-- Tab Navigation -->
      <ul class="nav nav-tabs mb-4" id="inventoryTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="current-tab" data-bs-toggle="tab" data-bs-target="#current" type="button" role="tab">
            <i class="fa-solid fa-box me-2"></i>Tồn kho hiện tại
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab">
            <i class="fa-solid fa-clock-rotate-left me-2"></i>Lịch sử nhập - xuất
          </button>
        </li>
      </ul>

      <!-- Tab Content -->
      <div class="tab-content" id="inventoryTabContent">
        
        <!-- Tab Tồn kho hiện tại -->
        <div class="tab-pane fade show active" id="current" role="tabpanel">
          <!-- Thống kê tồn kho -->
          <div class="row inventory-stats">
            <div class="col-md-3 stat-item">
              <div class="stat-number" id="totalProducts">123</div>
              <div class="stat-label">Tổng tồn kho</div>
            </div>
            <div class="col-md-3 stat-item">
              <div class="stat-number" id="totalProducts">7</div>
              <div class="stat-label">Sản phẩm</div>
            </div>
            <div class="col-md-3 stat-item">
              <div class="stat-number text-warning" id="warningProducts">3</div>
              <div class="stat-label">Sắp hết hàng</div>
            </div>
            <div class="col-md-3 stat-item">
              <div class="stat-number" id="inStockProducts">4</div>
              <div class="stat-label">Còn hàng</div>
            </div>
          </div>

          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="alert alert-warning mb-0 flex-grow-1 me-3">
              <i class="fa-solid fa-triangle-exclamation me-2"></i>
              <strong>Cảnh báo:</strong> Có <span id="warningCount" class="fw-bold">3</span> sản phẩm sắp hết hàng.
            </div>
            <div class="d-flex gap-2">
              <div>
                <input class="form-control" type="date" id="checkDate" value="2025-10-25">
              </div>
              <input id="searchInventory" class="form-control" placeholder="Tìm kiếm theo tên hoặc mã sản phẩm...">
              <select id="filterStatus" class="form-select" style="width: 250px;">
                <option value="">Trạng thái</option>
                <option value="Còn hàng">Còn hàng</option>
                <option value="Sắp hết">Sắp hết</option>
              </select>
            </div>
          </div>

          <div class="card shadow-sm">
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover align-middle text-center">
                  <thead class="table-light">
                    <tr>
                      <th>Mã sản phẩm</th>
                      <th>Ảnh</th>
                      <th>Tên sản phẩm</th>
                      <th>Số lượng tồn</th>
                      <th>Đơn vị</th>
                      <th>Giá nhập (VNĐ)</th>
                      <th>Trạng thái</th>
                    </tr>
                  </thead>
                  <tbody id="inventoryTableBody"></tbody>
                </table>
                <ul id="pagination">
                  <li class="pagination-item">
                    <a href="7_inventory.html" class="pagination-item__link active">1</a>
                  </li>
                  <li class="pagination-item">
                    <a href="7_inventory.html" class="pagination-item__link">2</a>
                  </li>
                  <li class="pagination-item">
                    <a href="7_inventory.html" class="pagination-item__link">3</a>
                  </li>
                  <li class="pagination-item">
                    <a href="7_inventory.html" class="pagination-item__link">4</a>
                  </li>
                  <li class="pagination-item">
                    <a href="7_inventory.html" class="pagination-item__link">5</a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- Tab Lịch sử nhập - xuất -->
        <div class="tab-pane fade" id="history" role="tabpanel">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="d-flex gap-2 align-items-center">
              <div>
                <label for="startDate" class="form-label">Từ ngày</label>
                <input class="form-control" type="date" id="startDate" value="2025-10-01">
              </div>
              <div>
                <label for="endDate" class="form-label">Đến ngày</label>
                <input class="form-control" type="date" id="endDate" value="2025-10-25">
              </div>
              <button class="btn btn-success mt-4" id="filterHistory">
                <i class="fa-solid fa-filter me-2"></i>Lọc
              </button>
            </div>
            <input id="searchHistory" class="form-control" placeholder="Tìm kiếm theo tên sản phẩm..." style="width: 300px;">
          </div>

          <div class="card shadow-sm">
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover align-middle text-center">
                  <thead class="table-light">
                    <tr>
                      <th>Mã sản phẩm</th>
                      <th>Ảnh</th>
                      <th>Tên sản phẩm</th>
                      <th>Tồn đầu kỳ</th>
                      <th>Nhập</th>
                      <th>Xuất</th>
                      <th>Tồn cuối kỳ</th>
                    </tr>
                  </thead>
                  <tbody id="historyTableBody"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <footer class="mt-4">
        <p class="text-center text-muted">&copy; 2024 Bloom - Shop hoa tươi. All rights reserved.</p>
      </footer>
    </div>
  </div>

  <div class="position-fixed top-0 end-0 p-3" style="z-index: 1080" id="toastContainer"></div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>
    AOS.init();

    // Hàm random ảnh sản phẩm
    function getRandomProductImage() {
      const productImages = [
        '../images/hoa1.jpg',
        '../images/hoa2.jpg',
        '../images/hoa3.jpg',
        '../images/hoa4.jpg',
        '../images/langhoa1.webp',
        '../images/langhoa2.jpg',
        '../images/langhoa3.png',
        '../images/kehoa1.jpg',
        '../images/kehoa2.jpg',
        '../images/kehoa3.jpg'
      ];
      
      const randomIndex = Math.floor(Math.random() * productImages.length);
      return productImages[randomIndex];
    }

    // Dữ liệu tồn kho hiện tại
    let inventory = [
      { code: 'P001', name: 'Peach', quantity: 43, unit: 'bó', price: 600000, status: 'Còn hàng', image: getRandomProductImage() },
      { code: 'P002', name: 'BlueSky', quantity: 1, unit: 'bó', price: 180000, status: 'Sắp hết', image: getRandomProductImage() },
      { code: 'P003', name: 'Hồng Phát', quantity: 10, unit: 'kệ', price: 2450000, status: 'Còn hàng', image: getRandomProductImage() },
      { code: 'P004', name: 'Sen Xanh', quantity: 72, unit: 'lẵng', price: 1450000, status: 'Còn hàng', image: getRandomProductImage() },
      { code: 'P005', name: 'Tương Lai', quantity: 3, unit: 'bó', price: 1150000, status: 'Sắp hết', image: getRandomProductImage() },
      { code: 'P006', name: 'BlueBerry', quantity: 3, unit: 'bó', price: 180000, status: 'Sắp hết', image: getRandomProductImage() },
      { code: 'P007', name: 'Nhiệt Ái', quantity: 20, unit: 'bó', price: 600000, status: 'Còn hàng', image: getRandomProductImage() },
    ];

    // Dữ liệu lịch sử nhập xuất
    let inventoryHistory = [
      { id: 1, name: 'Peach', startQuantity: 40, import: 15, export: 12, endQuantity: 43, image: getRandomProductImage() },
      { id: 2, name: 'BlueSky', startQuantity: 5, import: 6, export: 4, endQuantity: 1, image: getRandomProductImage() },
      { id: 3, name: 'Hồng Phát', startQuantity: 8, import: 5, export: 3, endQuantity: 10, image: getRandomProductImage() },
      { id: 4, name: 'Sen Xanh', startQuantity: 65, import: 20, export: 13, endQuantity: 72, image: getRandomProductImage() },
      { id: 5, name: 'Tương Lai', startQuantity: 10, import: 3, export: 7, endQuantity: 3, image: getRandomProductImage() },
      { id: 6, name: 'BlueBerry', startQuantity: 8, import: 0, export: 5, endQuantity: 3, image: getRandomProductImage() },
      { id: 7, name: 'Nhiệt Ái', startQuantity: 15, import: 10, export: 0, endQuantity: 20, image: getRandomProductImage() },
    ];

    const tbody = document.getElementById('inventoryTableBody');
    const historyTbody = document.getElementById('historyTableBody');
    const toastContainer = document.getElementById('toastContainer');

    function showToast(message, type = 'success') {
      const bg = type === 'error' ? 'bg-danger' : 'bg-success';
      const toast = document.createElement('div');
      toast.className = `toast align-items-center text-white border-0 ${bg}`;
      toast.role = 'alert';
      toast.innerHTML = `
        <div class="d-flex">
          <div class="toast-body">${message}</div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>`;
      toastContainer.appendChild(toast);
      const bsToast = new bootstrap.Toast(toast, { delay: 2000 });
      bsToast.show();
      toast.addEventListener('hidden.bs.toast', () => toast.remove());
    }

    function getStatusBadge(status, quantity) {
      if (status === 'Sắp hết' || quantity <= 5) {
        return '<span class="badge warning-badge"><i class="fa-solid fa-triangle-exclamation me-1"></i>Sắp hết</span>';
      } else {
        return '<span class="badge success-badge"><i class="fa-solid fa-check-circle me-1"></i>Còn hàng</span>';
      }
    }

    function getRowClass(status, quantity) {
      if (status === 'Sắp hết' || quantity <= 5) {
        return 'warning-row';
      }
      return '';
    }

    // Render bảng tồn kho hiện tại
    function renderInventoryTable(data) {
      tbody.innerHTML = '';
      data.forEach((item, i) => {
        const rowClass = getRowClass(item.status, item.quantity);
        const statusBadge = getStatusBadge(item.status, item.quantity);

        tbody.innerHTML += `
          <tr class="${rowClass}">
            <td>${item.code}</td>
            <td>
              <img src="${item.image}" alt="${item.name}" class="product-img">
            </td>
            <td>${item.name}</td>
            <td><strong>${item.quantity}</strong></td>
            <td>${item.unit}</td>
            <td>${item.price.toLocaleString()}</td>
            <td>${statusBadge}</td>
          </tr>`;
      });
      updateInventoryStats();
    }

    // Render bảng lịch sử nhập xuất
    function renderHistoryTable(data) {
      historyTbody.innerHTML = '';
      data.forEach((item, i) => {
        historyTbody.innerHTML += `
          <tr>
            <td>P00${i + 1}</td>
            <td>
              <img src="${item.image}" alt="${item.name}" class="product-img">
            </td>
            <td>${item.name}</td>
            <td>${item.startQuantity}</td>
            <td class="text-success fw-bold">+${item.import}</td>
            <td class="text-danger fw-bold">-${item.export}</td>
            <td class="text-primary fw-bold">${item.endQuantity}</td>
          </tr>`;
      });
    }

    // Khởi tạo
    renderInventoryTable(inventory);
    renderHistoryTable(inventoryHistory);

    function normalize(str) {
      return str.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase();
    }

    // Filter tồn kho
    document.getElementById('searchInventory').addEventListener('input', filterInventory);
    document.getElementById('filterStatus').addEventListener('change', filterInventory);

    function filterInventory() {
      const keyword = normalize(document.getElementById('searchInventory').value);
      const status = document.getElementById('filterStatus').value;
      const filtered = inventory.filter(p =>
        (normalize(p.name).includes(keyword) || normalize(p.code).includes(keyword)) &&
        (status === '' || p.status === status)
      );
      renderInventoryTable(filtered);
    }

    // Filter lịch sử
    document.getElementById('searchHistory').addEventListener('input', filterHistory1);
    document.getElementById('filterHistory').addEventListener('click', filterHistory);

    function filterHistory() {
      alert("Đang hiển thị thông tin hàng tồn trong kì.")
    }

    // Cập nhật thống kê
    function updateInventoryStats() {
      const warningCount = inventory.filter(item => item.status === 'Sắp hết' || item.quantity <= 5).length;
      const inStockCount = inventory.filter(item => item.status === 'Còn hàng' && item.quantity > 5).length;
      
      document.getElementById('warningProducts').textContent = warningCount;
      document.getElementById('inStockProducts').textContent = inStockCount;
      document.getElementById('warningCount').textContent = warningCount;
    }

    // Phân trang
    const pagination = document.getElementById('pagination');
    pagination.addEventListener('click', e => {
      if (e.target.classList.contains('pagination-item__link')) {
        e.preventDefault();
        const currentActive = pagination.querySelector('.pagination-item__link.active');
        if (currentActive) currentActive.classList.remove('active');
        e.target.classList.add('active');
      }
    });

    const historyPagination = document.getElementById('historyPagination');
    historyPagination.addEventListener('click', e => {
      if (e.target.classList.contains('pagination-item__link')) {
        e.preventDefault();
        const currentActive = historyPagination.querySelector('.pagination-item__link.active');
        if (currentActive) currentActive.classList.remove('active');
        e.target.classList.add('active');
      }
    });
  </script>
  <script src="assets/js/info_admin.js"></script>
</body>

</html>